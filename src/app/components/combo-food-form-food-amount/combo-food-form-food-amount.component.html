<ng-container [formGroup]="foodAmountCtrl">
    <mat-card class="mat-elevation-z8">
        <mat-form-field>
            <!-- Food Name -->
            <mat-label>Food Name</mat-label>
            <input matInput placeholder="Ex. Peanut butter" formControlName="foodName" [matAutocomplete]="foodAC">
            <!-- TODO: Skip clear button in tabbing -->
            <!-- TODO: add confirmation dialog whenever deleting something -->
            <button mat-button *ngIf="foodAmountCtrl.get('foodName').value" matSuffix mat-icon-button
                (click)="foodAmountCtrl.get('foodName').setValue('')">
                <mat-icon>close</mat-icon>
            </button>
        </mat-form-field>
        <mat-autocomplete autoActiveFirstOption #foodAC="matAutocomplete">
            <mat-option *ngFor="let option of foodACOptions | async" [value]="option.description"
                (onSelectionChange)="updateSelectedFood(option, $event)" class="food-ac-option">
                <div class="description">{{option.description}}</div>
                <div class="brand-owner">{{option.brandOwner}}</div>
            </mat-option>
        </mat-autocomplete>

        <!-- Amount -->
        <mat-form-field floatLabel="always" class="household-measure-amount">
            <mat-label>Amount</mat-label>
            <input matInput [appMask]="['non-negative', 'float-hundredths']" placeholder="12.5"
                formControlName="amount">
        </mat-form-field>

        <!-- Unit -->
        <mat-form-field>
            <mat-label>Unit</mat-label>
            <!-- TODO: Add dynamic placeholder that is one of appropriate choices -->
            <!-- TODO add validation for unit being one of autocomplete options -->
            <input matInput placeholder="g" formControlName="unit"
                [matAutocomplete]="filteredAutocompleteComponent?.matAutocomplete">
            <app-filtered-autocomplete [filterChanges]="foodAmountCtrl.get('unit').valueChanges"
                [autoCompleteOpts]="unitACOptions"></app-filtered-autocomplete>
        </mat-form-field>

        <!-- Caloric Breakdown -->
        <ng-container *ngIf="foodCtrl.value && false">
            <table mat-table [dataSource]="caloricBreakdownDataSource" class="mat-elevation-z2 caloric-breakdown">

                <!-- Fat Column -->
                <ng-container matColumnDef="fat">
                    <th mat-header-cell *matHeaderCellDef> Fat </th>
                    <td mat-cell *matCellDef="let elm">
                        <div>{{elm.fat | number: '1.0-1'}}%</div>
                        <div class="vis-pctg-indicator fat" [style.height]="elm.fat+'%'"></div>
                    </td>
                </ng-container>

                <!-- Carbs Column -->
                <ng-container matColumnDef="carbs">
                    <th mat-header-cell *matHeaderCellDef> Carbs </th>
                    <td mat-cell *matCellDef="let elm">
                        <div>{{elm.carbs | number: '1.0-1'}}%</div>
                        <div class="vis-pctg-indicator carbs" [style.height]="elm.carbs+'%'"></div>
                    </td>
                </ng-container>

                <!-- Protein Column -->
                <ng-container matColumnDef="protein">
                    <th mat-header-cell *matHeaderCellDef> Protein </th>
                    <td mat-cell *matCellDef="let elm">
                        <div>{{elm.protein | number: '1.0-1'}}%</div>
                        <div class="vis-pctg-indicator protein" [style.height]="elm.protein+'%'"></div>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="caloricBreakdownDisplayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: caloricBreakdownDisplayedColumns;"></tr>
            </table>

        </ng-container>

        <h4>Caloric Breakdown</h4>

        <!-- Caloric Breakdown as a Constituent-->
        <table mat-table [dataSource]="cstCaloricBreakdownDataSource" class="mat-elevation-z2 caloric-breakdown">

            <!-- Calories Column -->
            <ng-container matColumnDef="cal">
                <th mat-header-cell *matHeaderCellDef> kcal </th>
                <td mat-cell *matCellDef="let elm">
                    <div>
                        <div>{{elm.cal.amount | number: '1.1-1'}} ({{elm.cal.pctg | number: '1.1-1'}}%)</div>
                    </div>
                    <div class="vis-pctg-indicator cal" [style.height]="elm.cal.pctg+'%'"></div>
                </td>
            </ng-container>

            <!-- Fat Column -->
            <ng-container matColumnDef="fat">
                <th mat-header-cell *matHeaderCellDef> Fat </th>
                <td mat-cell *matCellDef="let elm">
                    <div>
                        <div>{{elm.fat.amount | number: '1.1-1'}}g ({{elm.fat.pctg | number: '1.1-1'}}%)</div>
                    </div>
                    <div class="vis-pctg-indicator fat" [style.height]="elm.fat.pctg+'%'"></div>
                </td>
            </ng-container>

            <!-- Carbs Column -->
            <ng-container matColumnDef="carbs">
                <th mat-header-cell *matHeaderCellDef> Carbs </th>
                <td mat-cell *matCellDef="let elm">
                    <div>{{elm.carbs.amount | number: '1.1-1'}}g ({{elm.carbs.pctg | number: '1.1-1'}}%)</div>
                    <div class="vis-pctg-indicator carbs" [style.height]="elm.carbs.pctg+'%'"></div>
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>

            <!-- Protein Column -->
            <ng-container matColumnDef="protein">
                <th mat-header-cell *matHeaderCellDef> Protein </th>
                <td mat-cell *matCellDef="let elm">
                    <div>{{elm.protein.amount | number: '1.1-1'}}g ({{elm.protein.pctg | number: '1.1-1'}}%)</div>
                    <div class="vis-pctg-indicator protein" [style.height]="elm.protein.pctg+'%'"></div>
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>

            <ng-container matColumnDef="noData">
                <td mat-footer-cell *matFooterCellDef>Awaiting food information...</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="cstCaloricBreakdownDisplayedColumns"
                [ngClass]="{'hidden-row':!(cstCaloricBreakdownDataSource | async)?.length}"></tr>
            <tr mat-row *matRowDef="let row; columns: cstCaloricBreakdownDisplayedColumns;"
                [ngClass]="{'hidden-row':!(cstCaloricBreakdownDataSource | async)?.length}"></tr>
            <tr mat-footer-row *matFooterRowDef="['noData']"
                [ngClass]="{'hidden-row':(cstCaloricBreakdownDataSource | async)?.length}"></tr>

        </table>



        <!-- <button (click)=logit() type="button">logit</button> -->
    </mat-card>
</ng-container>